import{P as m,j as e,B as v,r,O as A}from"./index-B0jkiz79.js";import{R as F,F as S,I as y,P}from"./Table-CDgjk8mE.js";import{M as T,a as O,A as $}from"./common-settings-Dh5tLxIY.js";import{F as d,s as f}from"./index-C6nPlHol.js";const w=({dataSource:o,columns:n,isModalOpen:l,form:p,onAddClick:h,onCancelModal:g,onSave:M,modalTitle:c})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{children:"Materiales"}),e.jsx(v,{type:"primary",icon:e.jsx(F,{}),onClick:h,children:"Agregar Materia"})]}),e.jsx(S,{dataSource:o,columns:n,rowKey:"key"}),e.jsx(T,{title:c,open:l,onCancel:g,onOk:M,children:e.jsxs(d,{form:p,layout:"vertical",children:[e.jsx(d.Item,{name:"material",label:"Nombre",rules:[{required:!0,message:"Por favor ingrese el nombre"}],children:e.jsx(y,{})}),e.jsx(d.Item,{name:"sv",label:"Veta",children:e.jsx(y,{})}),e.jsx(d.Item,{name:"thickness",label:"Espesor",children:e.jsx(y,{})}),e.jsx(d.Item,{name:"width",label:"Largo",rules:[{required:!0,message:"Por favor ingrese el largo"}],children:e.jsx(y,{})}),e.jsx(d.Item,{name:"height",label:"Ancho",rules:[{required:!0,message:"Por favor ingrese el ancho"}],children:e.jsx(y,{})}),e.jsx(d.Item,{name:"quantity",label:"Cantidad",rules:[{required:!0,message:"Por favor ingrese la cantidad"}],children:e.jsx(y,{})}),e.jsx(d.Item,{name:"availability",label:"Disponibilidad",rules:[{required:!0,message:"Por favor ingrese la disponibilidad"}],children:e.jsx(y,{})})]})})]});w.propTypes={dataSource:m.array.isRequired,columns:m.array.isRequired,isModalOpen:m.bool.isRequired,form:m.object.isRequired,onAddClick:m.func.isRequired,onCancelModal:m.func.isRequired,onSave:m.func.isRequired,modalTitle:m.string.isRequired};const D=(o,n="GET",l=null,p={})=>{const[h,g]=r.useState([]),[M,c]=r.useState(null),[j,E]=r.useState(!1),k=r.useMemo(()=>({"Content-Type":"application/json",...p}),[p]),x=r.useMemo(()=>l,[l]),s=r.useCallback(async(R=o,b=n,q=l)=>{var t,u;const a=new AbortController().signal;E(!0),c(null);try{const i=await O({url:R,method:b,headers:k,data:q,signal:a});return g(i.data),i.data}catch(i){if(!a.aborted)throw c({message:i.message,code:((t=i.response)==null?void 0:t.status)||"NETWORK_ERROR",details:((u=i.response)==null?void 0:u.data)||null}),i}finally{E(!1)}},[o,n,k,x]);return r.useEffect(()=>{o&&s()},[o]),{resData:h,error:M,loading:j,refetch:s,execute:s}},I=$.materials,_=()=>{const{setMaterialsCtx:o}=r.useContext(A),{resData:n,error:l,loading:p,refetch:h,execute:g}=D(I),[M,c]=r.useState([]),[j,E]=r.useState(""),[k,x]=r.useState(!1),[s]=d.useForm();r.useEffect(()=>{if(n&&Array.isArray(n.data)){const a=n.data.map(t=>({...t,key:t.id||t.documentId}));c(a),o(n.data)}},[n,o]),r.useEffect(()=>{l&&f.error(`Error al cargar materiales: ${l.message}`)},[l]);const R=async()=>{try{const a=await s.validateFields(),t=await g(I,"POST",a);c(u=>[...u,{key:t.documentId,...t}]),f.success("Material agregado correctamente"),s.resetFields(),x(!1),h()}catch(a){f.error(`Error al agregar material: ${a.message}`)}},b=async()=>{try{const a=await s.validateFields(),t=await g(`${I}/${j}`,"PUT",a);c(u=>u.map(i=>i.key===j?{...i,...t}:i)),f.success("Material actualizado correctamente"),s.resetFields(),x(!1),E(""),h()}catch(a){f.error(`Error al actualizar material: ${a.message}`)}},q=async a=>{try{await g(`${I}/${a}`,"DELETE"),c(t=>t.filter(u=>u.key!==a)),f.success("Material eliminado correctamente"),h()}catch(t){f.error(`Error al eliminar material: ${t.message}`)}},C=a=>{s.setFieldsValue(a),E(a.key),x(!0)};return e.jsx(w,{dataSource:M,columns:[{title:"Nombre",dataIndex:"material",key:"material"},{title:"Veta",dataIndex:"sv",key:"sv"},{title:"Espesor",dataIndex:"thickness",key:"thickness"},{title:"Largo",dataIndex:"width",key:"width"},{title:"Ancho",dataIndex:"height",key:"height"},{title:"Cantidad",dataIndex:"quantity",key:"quantity"},{title:"Acción",key:"accion",render:(a,t)=>e.jsxs(e.Fragment,{children:[e.jsx(v,{onClick:()=>C(t),style:{marginRight:8},children:"Editar"}),e.jsx(P,{title:"¿Seguro que quieres eliminar?",onConfirm:()=>q(t.key),children:e.jsx(v,{children:"Eliminar"})})]})}],isModalOpen:k,form:s,onAddClick:()=>{s.resetFields(),x(!0),E("")},onCancelModal:()=>x(!1),onSave:j?b:R,modalTitle:j===""?"Agregar Materia":"Editar Materia",loading:p})};export{_ as default};
